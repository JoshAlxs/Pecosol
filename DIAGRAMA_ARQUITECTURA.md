# ğŸ“Š DIAGRAMA VISUAL DE ARQUITECTURA

## ğŸ—ï¸ Arquitectura del Chatbot IA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BODESHOP ADMIN PANEL                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             INTERFAZ DEL CHATBOT (Vista)                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ Panel Info Lateralâ”‚  â”‚ Ãrea de Chat               â”‚   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ“¦ Productos     â”‚  â”‚ Bot: Hola, Â¿en quÃ© puedo   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ’° Ventas       â”‚  â”‚ ayudarte?                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ‘¥ Empleados    â”‚  â”‚                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ“Š EstadÃ­sticas â”‚  â”‚ User: Â¿Stock total?        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ âš ï¸ Bajo Stock   â”‚  â”‚                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚ Bot: Tienes 1,250 unidades â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                            â”‚   â”‚ â”‚
â”‚  â”‚                        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚ â”‚
â”‚  â”‚                        â”‚ â”‚ Input: pregunta...   â”‚   â”‚   â”‚ â”‚
â”‚  â”‚                        â”‚ â”‚ [Enviar]             â”‚   â”‚   â”‚ â”‚
â”‚  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“ JavaScript                             â”‚
â”‚                   (chatbot.js envÃ­a JSON)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP POST
                         â”‚ {"message": "Â¿Stock total?"}
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ENDPOINT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  api/chatbot.php                                                â”‚
â”‚  - Recibe POST JSON                                             â”‚
â”‚  - Valida entrada                                               â”‚
â”‚  - Instancia ChatbotController                                  â”‚
â”‚  - Retorna JSON response                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CHATBOT CONTROLLER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ChatbotController::apiChat()                                   â”‚
â”‚  - Obtiene el mensaje                                           â”‚
â”‚  - Llama a chat() con el mensaje                                â”‚
â”‚  - Retorna respuesta JSON                                       â”‚
â”‚                                                                  â”‚
â”‚  ChatbotController::chat()                                      â”‚
â”‚  - Obtiene contexto de BD vÃ­a ChatbotService                   â”‚
â”‚  - Construye prompt del sistema (buildSystemPrompt)            â”‚
â”‚  - Llama OpenAI API                                            â”‚
â”‚  - Procesa respuesta                                           â”‚
â”‚  - Retorna array con resultado                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Necesita datos BD    â”‚
             â†“                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ChatbotService   â”‚  â”‚ ConstrucciÃ³n de Prompt  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ getProducts()    â”‚  â”‚ Contexto actual:        â”‚
    â”‚ getSales()       â”‚  â”‚ - Total productos: 234  â”‚
    â”‚ getEmployees()   â”‚  â”‚ - Stock total: 1250     â”‚
    â”‚ getStatistics()  â”‚  â”‚ - Ventas Ãºltimos 7d: ..â”‚
    â”‚ getInventory()   â”‚  â”‚ - Empleados: 12         â”‚
    â”‚ getLowStock()    â”‚  â”‚ - Bajo stock: 5 items  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                       â”‚
             â†“                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      DATABASE (bodeshop_db)                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - products (name, price, stock)              â”‚
    â”‚ - sales (product_id, quantity, price)        â”‚
    â”‚ - employees (name, email, salary)            â”‚
    â”‚ - users (id, name)                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Datos Completo

```
Usuario escribe pregunta
        â”‚
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚chatbot. â”‚ JavaScript captura
   â”‚js       â”‚ evento y envÃ­a AJAX
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ POST JSON
        â”‚ Content-Type: application/json
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚api/chatbot.php   â”‚ Verifica mÃ©todo POST
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Instancia ChatbotController
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ChatbotController::apiChat()â”‚ Obtiene mensaje del JSON
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Llama chat($message)
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ChatbotController::chat() â”‚ 1. Obtiene contexto
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    (ChatbotService)
   â”‚ buildSystemPrompt()      â”‚ 2. Construye prompt
   â”‚ OpenAI API call          â”‚ 3. Llama OpenAI
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 4. Retorna respuesta
        â”‚
        â”‚ Array con:
        â”‚ - success: true/false
        â”‚ - response: texto
        â”‚ - timestamp: fecha
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚api/chatbot.php       â”‚ Convierte array a JSON
   â”‚json_encode()         â”‚ Setea headers correcto
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ JSON response
        â”‚ {"success": true, "response": "...", ...}
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚chatbot.js   â”‚ Recibe respuesta
   â”‚fetch()      â”‚ Parsea JSON
   â”‚then()       â”‚ Valida Ã©xito
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Agrega mensaje a UI
        â”‚ addMessage(response, 'bot')
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚DOM actualizado           â”‚ Mensaje aparece
   â”‚- Nueva div.message       â”‚ en el chat
   â”‚- Contenido rendereado    â”‚
   â”‚- Scroll automÃ¡tico       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
   Usuario ve respuesta
```

---

## ğŸ“ Estructura de Carpetas

```
bodeshop/
â”‚
â”œâ”€â”€ ğŸ“„ INICIO_RAPIDO.md                    â† EMPIEZA AQUÃ
â”œâ”€â”€ ğŸ“„ GUIA_CHATBOT.md                     â† GuÃ­a detallada
â”œâ”€â”€ ğŸ“„ RESUMEN_IMPLEMENTACION.md
â”œâ”€â”€ ğŸ“„ CHECKLIST_IMPLEMENTACION.md
â”œâ”€â”€ ğŸ“„ COMANDOS_POWERSHELL.md
â”‚
â”œâ”€â”€ ğŸ”§ config/
â”‚   â”œâ”€â”€ config.php                         (existente)
â”‚   â”œâ”€â”€ database.php                       (existente)
â”‚   â””â”€â”€ openai.php                         â­ NUEVO - Tu API Key aquÃ­
â”‚
â”œâ”€â”€ ğŸ® controllers/
â”‚   â”œâ”€â”€ AdminController.php                (existente)
â”‚   â”œâ”€â”€ AuthController.php                 (existente)
â”‚   â”œâ”€â”€ DashboardController.php            (existente)
â”‚   â”œâ”€â”€ EmployeeController.php             (existente)
â”‚   â””â”€â”€ ChatbotController.php              â­ NUEVO
â”‚
â”œâ”€â”€ ğŸ“Š models/
â”‚   â”œâ”€â”€ Employee.php                       (existente)
â”‚   â”œâ”€â”€ Product.php                        (existente)
â”‚   â”œâ”€â”€ Sale.php                           (existente)
â”‚   â”œâ”€â”€ User.php                           (existente)
â”‚   â””â”€â”€ ChatbotService.php                 â­ NUEVO
â”‚
â”œâ”€â”€ ğŸŒ views/
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ dashboard.php                  (existente)
â”‚   â”‚   â”œâ”€â”€ chatbot.php                    â­ NUEVO
â”‚   â”‚   â”œâ”€â”€ employee/                      (existente)
â”‚   â”‚   â”œâ”€â”€ productos/                     (existente)
â”‚   â”‚   â”œâ”€â”€ ventas/                        (existente)
â”‚   â”‚   â””â”€â”€ partials/
â”‚   â”‚       â””â”€â”€ header.php                 (MODIFICADO - BotÃ³n chatbot)
â”‚   â””â”€â”€ employee/                          (existente)
â”‚
â”œâ”€â”€ ğŸ¨ assets/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ style.css                      (existente)
â”‚   â”‚   â””â”€â”€ chatbot.css                    â­ NUEVO
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ script.js                      (existente)
â”‚   â”‚   â”œâ”€â”€ chart.umd.js                   (existente)
â”‚   â”‚   â””â”€â”€ chatbot.js                     â­ NUEVO
â”‚   â””â”€â”€ img/                               (existente)
â”‚
â”œâ”€â”€ ğŸ”Œ api/
â”‚   â”œâ”€â”€ chatbot.php                        â­ NUEVO - Endpoint
â”‚   â””â”€â”€ chatbot_debug.php                  â­ NUEVO - Debug
â”‚
â”œâ”€â”€ ğŸ§ª test_chatbot.php                    â­ NUEVO - Testing
â”‚
â”œâ”€â”€ composer.json                          (MODIFICADO - OpenAI)
â”œâ”€â”€ vendor/                                (actualizado con composer)
â””â”€â”€ ... (otros archivos)
```

---

## ğŸ” Seguridad - Capas de ProtecciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT VALIDATION                   â”‚
â”‚  - Validar mÃ©todo POST              â”‚
â”‚  - Verificar JSON vÃ¡lido            â”‚
â”‚  - Sanitizar mensaje del usuario    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHATBOT LOGIC                      â”‚
â”‚  - Construir prompt seguro          â”‚
â”‚  - No exponer datos sensibles       â”‚
â”‚  - Limitar contexto                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API CALL TO OPENAI                 â”‚
â”‚  - API Key protegida (env var)      â”‚
â”‚  - HTTPS encryption                 â”‚
â”‚  - Rate limiting (optional)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESPONSE HANDLING                  â”‚
â”‚  - Validar respuesta JSON           â”‚
â”‚  - Error handling robusto           â”‚
â”‚  - No exponer errores internos      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER OUTPUT                        â”‚
â”‚  - Escapar HTML en frontend         â”‚
â”‚  - Mostrar solo info relevante      â”‚
â”‚  - Logging de acciones              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Stack TecnolÃ³gico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYERS ARQUITECTURA                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Frontend:                                          â”‚
â”‚  â”œâ”€ HTML (chatbot.php)                             â”‚
â”‚  â”œâ”€ CSS (chatbot.css) - Responsive, moderno       â”‚
â”‚  â””â”€ JavaScript (chatbot.js) - AJAX, localStorage   â”‚
â”‚                                                      â”‚
â”‚  Backend:                                           â”‚
â”‚  â”œâ”€ PHP 7.4+ (Controllers, Models, Services)      â”‚
â”‚  â”œâ”€ OpenAI PHP SDK (openai-php/client)            â”‚
â”‚  â””â”€ PDO (Database abstraction)                     â”‚
â”‚                                                      â”‚
â”‚  Database:                                          â”‚
â”‚  â””â”€ MySQL (bodeshop_db)                            â”‚
â”‚     â”œâ”€ products                                     â”‚
â”‚     â”œâ”€ sales                                        â”‚
â”‚     â”œâ”€ employees                                    â”‚
â”‚     â””â”€ users                                        â”‚
â”‚                                                      â”‚
â”‚  External APIs:                                     â”‚
â”‚  â””â”€ OpenAI REST API (GPT-4o Mini)                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Flujo de Respuesta

```
Pregunta: "Â¿QuÃ© productos tienen bajo stock?"
    â”‚
    â†“
[ChatbotService consulta BD]
Bajo Stock: 
  - Producto A: 3 unidades
  - Producto B: 8 unidades
  - Producto C: 5 unidades
    â”‚
    â†“
[Construye Prompt]
"Eres un asistente... Contexto actual:
 - Total productos: 234
 - Stock total: 1,250
 - Productos bajo stock: 3 items
 
 Â¿QuÃ© productos tienen bajo stock?"
    â”‚
    â†“
[OpenAI Procesa]
GPT-4o Mini analiza el contexto
    â”‚
    â†“
[Genera Respuesta]
"SegÃºn tu inventario, tienes 3 productos 
con stock crÃ­tico:
- Producto A: Solo 3 unidades
- Producto B: 8 unidades
- Producto C: 5 unidades

Te recomiendo hacer un pedido urgente 
de estos items."
    â”‚
    â†“
Usuario ve respuesta en el chat
```

---

## ğŸ¯ Casos de Uso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CASOS DE USO DEL CHATBOT        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ 1. ANÃLISIS DE INVENTARIO               â”‚
â”‚    "Â¿CuÃ¡ntos productos hay?"            â”‚
â”‚    â†’ Datos: Productos totales, stock    â”‚
â”‚                                          â”‚
â”‚ 2. REPORTE DE VENTAS                    â”‚
â”‚    "Â¿CuÃ¡les fueron las ventas hoy?"     â”‚
â”‚    â†’ Datos: Total, cantidad, empleado   â”‚
â”‚                                          â”‚
â”‚ 3. ALERTAS DE STOCK                     â”‚
â”‚    "Â¿Bajo stock?"                       â”‚
â”‚    â†’ Datos: Productos < 10 unidades     â”‚
â”‚                                          â”‚
â”‚ 4. ANÃLISIS DE TENDENCIAS               â”‚
â”‚    "Â¿EvoluciÃ³n de ventas en 7 dÃ­as?"    â”‚
â”‚    â†’ Datos: GrÃ¡fica, promedio, mÃ¡ximo   â”‚
â”‚                                          â”‚
â”‚ 5. CONSULTAS DE EMPLEADOS               â”‚
â”‚    "Â¿QuiÃ©nes son nuestros empleados?"   â”‚
â”‚    â†’ Datos: Nombre, puesto, email       â”‚
â”‚                                          â”‚
â”‚ 6. ANÃLISIS PREDICTIVO                  â”‚
â”‚    "Â¿Recomendaciones para stock?"       â”‚
â”‚    â†’ Datos: Basado en histÃ³rico ventas  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Modelo de Costos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ESTIMACIÃ“N DE COSTOS MENSUALES      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚ Mensajes/mes:        50                â”‚
â”‚ Tokens promedio:     ~200 entrada      â”‚
â”‚                      ~150 salida       â”‚
â”‚                                        â”‚
â”‚ GPT-4o Mini:                          â”‚
â”‚ Entrada: 50 Ã— 200 Ã— $0.00015 = $1.50  â”‚
â”‚ Salida:  50 Ã— 150 Ã— $0.0006  = $4.50  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚ TOTAL:                  ~$6/mes        â”‚
â”‚                                        â”‚
â”‚ Si usas 200 mensajes/mes:   ~$24/mes  â”‚
â”‚                                        â”‚
â”‚ âœ… MUY ECONÃ“MICO para un negocio       â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Este diagrama visual resume la arquitectura completa del sistema. ğŸ¨

Cualquier pregunta sobre cÃ³mo funciona, revisa la **GUIA_CHATBOT.md**.
